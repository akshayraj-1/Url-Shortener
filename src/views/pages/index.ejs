<%- layout('main') -%>

<div id="modal-url" class="fixed z-[60] hidden justify-center items-center px-6 h-screen w-screen bg-black/70 backdrop-blur-[4px]">
    <div class="flex flex-col p-6 md:p-8 w-full max-w-[400px] bg-surface rounded-xl border border-textTertiary/40">
        <div class="flex items-center justify-between">
            <h3 class="text-xl font-semibold">Your shortened link</h3>
            <i id="btn-close-modal" class="ri-close-line text-xl text-textSecondary cursor-pointer"></i>
        </div>
        <div class="flex justify-evenly items-center mt-8">
            <i id="btn-share-whatsapp" class="p-5 rounded-full border border-textTertiary cursor-pointer" title="WhatsApp">
                <img src="/images/whatsapp.svg" alt="whatsapp" class="size-7">
            </i>
            <i id="btn-share-twitter" class="p-5 rounded-full border border-textTertiary cursor-pointer" title="X">
                <img src="/images/twitter-alt.svg" alt="twitter" class="size-7">
            </i>
            <i id="btn-share-email" class="p-5 rounded-full border border-textTertiary cursor-pointer" title="Email">
                <img src="/images/envelope.svg" alt="email" class="size-7">
            </i>
        </div>
        <div class="relative mt-8 mb-4 px-4 py-2.5 rounded-md bg-surfaceVariant/50 border border-textTertiary/40 overflow-hidden">
            <span id="short-url" class="text-sm text-textPrimary w-full overflow-ellipsis overflow-hidden me-2">https://localhost:3939/ssfras23</span>
            <i id="btn-copy-url" class="absolute top-0 right-0 flex items-center justify-center px-3 bg-primary text-white h-full ri-file-copy-line cursor-pointer" title="Copy"></i>
        </div>
    </div>
</div>

<div class="relative grid grid-cols-1 lg:grid-cols-2 gap-12 px-6 md:px-40 h-full w-full min-h-screen py-40">

    <div class="flex flex-col justify-center items-start gap-5 h-full w-full">
        <span class="text-sm text-primary bg-primary/5 rounded-full px-5 py-2.5">Let's make with simply one click ðŸ‘ˆ</span>
        <h1 class="relative text-[55px] md:text-[5.1rem] leading-none font-gelica-black font-bold">
            <span class="absolute -top-8 right-0 size-12 bg-star bg-no-repeat bg-contain"></span>
            Shorten urls made easy
        </h1>
        <p class="text-base text-textSecondary mt-2">Shorten, personalize and optimize your links to boost<br>your online presence
            and grow your business.</p>
       <div class="flex items-center gap-2 p-2.5 mt-3 bg-surface w-full max-w-[440px] rounded-full border border-textTertiary/50 shadow-lg shadow-textTertiary/10">
           <i class="grid place-content-center ri-links-line ms-3 me-1 text-textPrimary text-[20px]"></i>
           <input id="input-url" class="text-[0.95rem] w-full outline-none border-none" type="text" placeholder="Paste a link to shorten it">
           <button id="btn-shorten" class="text-sm text-white bg-primary px-6 py-3 rounded-full">Shorten</button>
       </div>
    </div>

    <div class="flex flex-col justify-center items-center w-full">
        <img class="w-full h-full object-contain select-none -scale-x-100" draggable="false" src="/images/hero2.svg" alt="hero">
    </div>

</div>

<script>
    const modal = document.querySelector("#modal-url");
    const inputUrl = document.querySelector("#input-url");
    const shortenUrl = document.querySelector("#short-url");
    const btnShorten = document.querySelector("#btn-shorten");
    const btnCloseModal = document.querySelector("#btn-close-modal");
    const btnShareWhatsapp = document.querySelector("#btn-share-whatsapp");
    const btnShareTwitter = document.querySelector("#btn-share-twitter");
    const btnShareEmail = document.querySelector("#btn-share-email");
    const btnCopyUrl = document.querySelector("#btn-copy-url");

    btnCloseModal.addEventListener("click", () => {
        modal.classList.toggle("flex", false);
        modal.classList.toggle("hidden", true);
    });

    btnShorten.addEventListener("click", async () => {
        console.log("Clicked");
        const url = inputUrl.value;
        if (!url) return;
        const response = await fetch("/api/short-url", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ url })
        });
        const data = await response.json();
        inputUrl.value = "";
        if (data.success) {
            modal.classList.toggle("flex", true);
            modal.classList.toggle("hidden", false);
            shortenUrl.textContent = data.data.shortenUrl;
            btnShareWhatsapp.addEventListener("click", () => {
                window.open(`https://api.whatsapp.com/send?text=${data.data.shortenUrl}`);
            });
            btnShareTwitter.addEventListener("click", () => {
                window.open(`https://twitter.com/intent/tweet?text=${data.data.shortenUrl}`);
            });
            btnShareEmail.addEventListener("click", () => {
                window.open(`mailto:?subject=Shorten URL&body=${data.data.shortenUrl}`);
            });
            btnCopyUrl.addEventListener("click", () => {
                navigator.clipboard.writeText(data.data.shortenUrl);
            });
        }
    });
</script>